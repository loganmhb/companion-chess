// Generated by CoffeeScript 1.10.0
(function() {
  var slice = [].slice;

  define(["jquery"], function($) {
    var parseMessage, parseMove, postMessage, sf, uciHistoryEl;
    uciHistoryEl = $("#ucihistory");
    sf = new Worker('js/lib/stockfish.js');
    parseMove = function(uciMove) {
      return {
        from: uciMove.slice(0, 2),
        to: uciMove.slice(2, 4)
      };
    };
    postMessage = function(message) {
      uciHistoryEl.append("<br>" + message);
      return sf.postMessage(message);
    };
    parseMessage = function(message) {
      var args, command, ref;
      uciHistoryEl.append("<br><span style=\"color: blue\">" + message + "</span>");
      ref = message.split(" "), command = ref[0], args = 2 <= ref.length ? slice.call(ref, 1) : [];
      switch (command) {
        case "bestmove":
          return {
            type: "bestmove",
            move: parseMove(args[0])
          };
        case "info":
          return {
            type: "info",
            args: args
          };
        default:
          return {
            type: "ignore"
          };
      }
    };
    return {
      searchForBestMove: function(fen, moveHandler) {
        sf.onmessage = function(event) {
          return moveHandler(parseMessage(event.data));
        };
        postMessage("position fen " + fen);
        return postMessage("go depth 8");
      }
    };
  });

}).call(this);
